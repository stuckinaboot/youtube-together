(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{17:function(e,t,n){e.exports=n(28)},27:function(e,t,n){},28:function(e,t,n){"use strict";n.r(t);var a,r=n(0),c=n.n(r),i=n(15),o=n.n(i),s=n(6),u=n(8),l=n(1),m=function(e){var t=Object(l.f)(),n=Object(l.g)(),a=n.sessionID,r=n.videoUrl,i=function(e){var t=e.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/);return!(!t||11!==t[7].length)&&t[7]};return c.a.createElement("div",null,function(){var n=decodeURIComponent(r),c=i(n);c&&(e.session(c,a,!0),t.push("/watch/leader"))}())},d=(n(27),function(e){var t=Object(r.useState)(e.videoID),n=Object(s.a)(t,2),i=n[0],o=n[1],u=Object(r.useState)({currentTime:0,shouldPause:!1,timestamp:0}),l=Object(s.a)(u,2),m=l[0],d=l[1],v=Object(r.useRef)(),f=function(){a=new window.YT.Player("player",{videoId:i,playerVars:{mute:1},events:{onReady:w,onStateChange:h}})};Object(r.useEffect)((function(){if(e.socket.addEventListener("message",(function(e){var t=JSON.parse(e.data);"sync"===t.event&&p(t),"join"===t.event&&(!function(e){o(e.videoID)}(t),null!=t.latestEvent&&d({currentTime:t.latestEvent.currentTime,shouldPause:"pause"===t.latestEvent.action,timestamp:t.latestEvent.timestamp}))})),null!==i)if(window.YT)f();else{var t=document.createElement("script");t.src="https://www.youtube.com/iframe_api",window.onYouTubeIframeAPIReady=f;var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)}}));var p=function(e){var t=a.getPlayerState();if("currenttime"!==e.action||2!==t&&-1!==t)"pause"===e.action&&2!==t&&g();else{var n=e.currentTime+(Date.now()-e.timestamp)/1e3;v.current=e,E(),b(n,!0)}},w=function(e){if(0===m.timestamp)return e.target.playVideo(),void(v.current={timestamp:Date.now(),currentTime:null!=e.target.getCurrentTime?e.target.getCurrentTime():0});v.current=m,e.target.playVideo(),m.shouldPause&&e.target.pauseVideo()},h=function(e){return j(e.data)},b=function(e){return a.seekTo(e,!0)},g=function(){return a.pauseVideo()},E=function(){return a.playVideo()},O=function(){var e=a.getCurrentTime();if(null!=v.current){var t=(Date.now()-v.current.timestamp)/1e3,n=v.current.currentTime+t;Math.abs(n-e)>.1&&(e=v.current.currentTime+t,b(e,!0))}return JSON.stringify({event:"sync",action:"currenttime",videoID:i,currentTime:e,timestamp:Date.now()})},j=function(t){1===t?e.socket.send(O()):2===t&&function(){var t=Date.now(),n=a.getCurrentTime();v.current={timestamp:t,currentTime:n},e.socket.send(JSON.stringify({event:"sync",action:"pause",currentTime:n,timestamp:t}))}()};return c.a.createElement("div",{className:"video"},c.a.createElement("div",{id:"player"},c.a.createElement("h3",null,"Loading...")))}),v=function(e){var t=Object(l.f)(),n=window.location.protocol.startsWith("https:"),a="".concat(n?"wss":"ws","://").concat(window.location.hostname,":",8e3,"/"),i=new WebSocket(a),o=e.sessionID,s=Object(l.g)().sessionID;return o||(o=s),Object(r.useEffect)((function(){i.onopen=function(){i.send(JSON.stringify({event:"session",action:e.action,sessionID:o,videoID:e.videoID}))}})),"leader"!==s||e.leader||t.push("/"),c.a.createElement(d,{videoID:e.videoID,leader:e.leader,sessionID:o,socket:i})};var f=function(){var e=Object(r.useState)(!1),t=Object(s.a)(e,2),n=t[0],a=t[1],i=Object(r.useState)(null),o=Object(s.a)(i,2),d=o[0],f=o[1],p=Object(r.useState)(null),w=Object(s.a)(p,2),h=w[0],b=w[1],g=Object(r.useState)("join"),E=Object(s.a)(g,2),O=E[0],j=E[1],y=function(e,t,n){b(e),f(t),a(n),j("create")};return c.a.createElement(u.a,null,c.a.createElement("div",{className:"skewed"}),c.a.createElement("div",{className:"container"},c.a.createElement("main",{className:"content"},c.a.createElement(l.c,null,c.a.createElement(l.a,{path:"/start/:sessionID/:videoUrl",render:function(){return c.a.createElement(m,{session:y})}}),c.a.createElement(l.a,{path:"/watch/:sessionID",render:function(){return c.a.createElement(v,{leader:n,sessionID:d,videoID:h,action:O})}})))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(f,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[17,1,2]]]);
//# sourceMappingURL=main.a7e9e6de.chunk.js.map